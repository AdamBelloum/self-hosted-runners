---
- hosts: all
  vars:
    # conda: true
    RUNNER_VERSION: 2.169.1
  vars_prompt:
    - name: "ORG"
      prompt: "What is the GitHub organization?"
      private: no
    - name: "REPO"
      prompt: "What is the GitHub repository?"
      private: no
    - name: "TOKEN"
      prompt: "Please enter the GitHub Actions token for this workflow"
      private: no
  remote_user: tester
  become: no
  tasks:

    - name: Showing the input variables
      debug:
        msg: "Setting up a GitHub runner for repository: https://github.com/{{ ORG }}/{{ REPO }}"

    - name: Creating a directory for the runner
      file:
        path: /tmp/actions-runner
        state: directory

    - name: Downloading and extracting the runner
      unarchive:
        src: https://github.com/actions/runner/releases/download/v{{ RUNNER_VERSION }}/actions-runner-linux-x64-{{ RUNNER_VERSION }}.tar.gz
        dest: /tmp/actions-runner/
        creates: /tmp/actions-runner/config.sh
        remote_src: yes

    - name: Configuring the GitHub Action runner
      command: chdir=/tmp/actions-runner ./config.sh --url https://github.com/{{ ORG }}/{{ REPO }} --token {{ TOKEN }}

    - name: Running the GitHub Action runner
      shell: /tmp/actions-runner/run.sh &
